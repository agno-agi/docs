---
title: Text-to-SQL Agent
description: Natural language to SQL with dynamic few-shot learning and self-learning capabilities.
---

A text-to-SQL system that:
1. Uses Agentic RAG to search for table metadata, sample queries and rules for writing better SQL queries.
2. Uses dynamic few-shot examples and rules to improve query construction.
3. Provides an interactive Streamlit UI for users to query the database.

We'll use the F1 dataset as an example, but you can easily extend it to other datasets.

### Key capabilities
- Natural language to SQL conversion
- Semantic model for table metadata guidance
- Knowledge base with query patterns and data quality notes
- Self-learning workflow (save validated queries for future use)
- Agentic memory for user preferences across sessions

### Simple queries to try
- "Who are the top 5 drivers with the most race wins?"
- "Compare Mercedes vs Ferrari performance in constructors championships"
- "Show me the progression of fastest lap times at Monza"
- "Which drivers have won championships with multiple teams?"
- "What tracks have hosted the most races?"
- "Show me Lewis Hamilton's win percentage by season"

### Advanced queries with table joins
- "How many races did the championship winners win each year?"
- "Compare the number of race wins vs championship positions for constructors in 2019"
- "Show me Lewis Hamilton's race wins and championship positions by year"
- "Which drivers have both won races and set fastest laps at Monaco?"
- "Show me Ferrari's race wins and constructor championship positions from 2015-2020"

## Code

The complete code is available in the [Agno repository](https://github.com/agno-agi/agno/tree/main/cookbook/01_showcase/01_agents/text_to_sql).

## Usage

<Steps>
  <Step title="Clone the repository">
    ```bash
    git clone https://github.com/agno-agi/agno.git
    cd agno
    ```
  </Step>

  <Step title="Create virtual environment">
    ```bash
    uv venv .venvs/text-to-sql --python 3.12
    source .venvs/text-to-sql/bin/activate
    ```
  </Step>

  <Step title="Install dependencies">
    ```bash
    uv pip install -r cookbook/01_showcase/01_agents/text_to_sql/requirements.in
    ```
  </Step>

  <Step title="Set up API keys">
    ```bash
    export OPENAI_API_KEY=***
    ```
  </Step>

  <Step title="Run PgVector">
    First, install [Docker Desktop](https://docs.docker.com/desktop/install/mac-install/).

    Then run either using the helper script:
    ```bash
    ./cookbook/scripts/run_pgvector.sh
    ```

    Or directly with Docker:
    ```bash
    docker run -d \
      -e POSTGRES_DB=ai \
      -e POSTGRES_USER=ai \
      -e POSTGRES_PASSWORD=ai \
      -e PGDATA=/var/lib/postgresql/data/pgdata \
      -v pgvolume:/var/lib/postgresql/data \
      -p 5532:5432 \
      --name pgvector \
      agnohq/pgvector:16
    ```
  </Step>

  <Step title="Check setup">
    ```bash
    python cookbook/01_showcase/01_agents/text_to_sql/scripts/check_setup.py
    ```
  </Step>

  <Step title="Load data and knowledge">
    ```bash
    python cookbook/01_showcase/01_agents/text_to_sql/scripts/load_f1_data.py
    python cookbook/01_showcase/01_agents/text_to_sql/scripts/load_knowledge.py
    ```
  </Step>

  <Step title="Run examples">
    ```bash
    # Basic queries
    python cookbook/01_showcase/01_agents/text_to_sql/examples/basic_queries.py

    # Self-learning demonstration
    python cookbook/01_showcase/01_agents/text_to_sql/examples/learning_loop.py

    # Data quality edge cases
    python cookbook/01_showcase/01_agents/text_to_sql/examples/edge_cases.py

    # Evaluate accuracy
    python cookbook/01_showcase/01_agents/text_to_sql/examples/evaluate.py
    ```
    Open localhost:8501 to start using the SQL Agent.
  </Step>
</Steps>

Need help? Join our [Discourse community](https://community.agno.com) for support!
