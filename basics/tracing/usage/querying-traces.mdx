---
title: Querying Traces
description: Filter, search, and analyze your agent traces
keywords: [tracing, querying, filtering, debugging, analysis]
---

Once tracing is enabled, you can query and analyze your agent's execution history. This guide covers all the ways to filter and retrieve traces.

## Trace Object Structure

When you query traces, you receive `Trace` objects with the following key fields:

| Field | Type | Description |
|-------|------|-------------|
| `trace_id` | `str` | Unique identifier that groups all spans in one execution |
| `name` | `str` | Name of the root operation (e.g., `Agent.run`, `Team.run`) |
| `status` | `str` | Overall status: `OK`, `ERROR`, or `UNSET` |
| `duration_ms` | `int` | Total execution time in milliseconds |
| `start_time` | `datetime` | When the trace started |
| `end_time` | `datetime` | When the trace completed |
| `total_spans` | `int` | Number of spans (operations) in this trace |
| `error_count` | `int` | Number of spans that errored |
| `run_id` | `str` | Associated agent/team/workflow run ID |
| `session_id` | `str` | Associated session ID |
| `user_id` | `str` | Associated user ID |
| `agent_id` | `str` | Associated agent ID |
| `team_id` | `str` | Associated team ID |
| `workflow_id` | `str` | Associated workflow ID |
| `created_at` | `datetime` | When the trace record was created |

<Accordion title="Full Trace class definition">

```python
from datetime import datetime
from typing import Optional
from pydantic import BaseModel, Field

class Trace(BaseModel):
    """Represents a complete execution trace"""
    
    trace_id: str = Field(..., description="Unique trace identifier")
    name: str = Field(..., description="Trace name (root span name)")
    status: str = Field(..., description="Overall status (OK, ERROR, UNSET)")
    duration_ms: int = Field(..., description="Total duration in milliseconds")
    start_time: datetime = Field(..., description="Trace start time")
    end_time: datetime = Field(..., description="Trace end time")
    total_spans: int = Field(0, description="Total number of spans")
    error_count: int = Field(0, description="Number of errored spans")
    
    # Context identifiers
    run_id: Optional[str] = Field(None, description="Associated run ID")
    session_id: Optional[str] = Field(None, description="Associated session ID")
    user_id: Optional[str] = Field(None, description="Associated user ID")
    agent_id: Optional[str] = Field(None, description="Associated agent ID")
    team_id: Optional[str] = Field(None, description="Associated team ID")
    workflow_id: Optional[str] = Field(None, description="Associated workflow ID")
    
    created_at: datetime = Field(..., description="Record creation time")
    
    def to_dict(self) -> dict:
        """Convert trace to dictionary"""
        ...
    
    @classmethod
    def from_dict(cls, data: dict) -> "Trace":
        """Create trace from dictionary"""
        ...
```

</Accordion>

## Query Methods

There are two methods for retrieving traces:

| Method | Returns | Use Case |
|--------|---------|----------|
| `db.get_trace()` | Single `Trace` or `None` | Fetch one trace by `trace_id` or `run_id` |
| `db.get_traces()` | `(List[Trace], count)` | List/filter multiple traces with pagination |

### `db.get_trace()` - Single Trace Lookup

Use `get_trace()` when you need a specific trace and know its identifier:

```python
from agno.db.sqlite import SqliteDb

db = SqliteDb(db_file="tmp/traces.db")

# Get trace by trace_id
trace = db.get_trace(trace_id="abc123...")
if trace:
    print(f"{trace.name}: {trace.duration_ms}ms")

# Or get trace by run_id (returns most recent match)
trace = db.get_trace(run_id=response.run_id)
```

<Tip>
  `get_trace()` is more efficient when you only need one trace. It returns `None` if no match is found.
</Tip>

### `db.get_traces()` - Multiple Traces with Filtering

Use `get_traces()` for listing, filtering, and paginating traces:

```python
# Get all traces (default limit: 20, page: 1)
traces, total_count = db.get_traces()

print(f"Retrieved {len(traces)} traces out of {total_count} total")

for trace in traces:
    print(f"{trace.name}: {trace.duration_ms}ms - {trace.status}")
```

<Info>
  `db.get_traces()` returns a tuple: `(traces, total_count)` where `traces` is a list of `Trace` objects and `total_count` is the total number of matching traces (useful for pagination).
</Info>

## Filtering by Agent

Get traces for a specific agent:

```python
from agno.agent import Agent
from agno.models.openai import OpenAIChat

agent = Agent(
    name="Research Agent",
    model=OpenAIChat(id="gpt-4o-mini"),
    instructions="Research topics",
)

# Run the agent
agent.run("What is machine learning?")

# Query traces for this specific agent
traces, count = db.get_traces(agent_id=agent.id, limit=10)

print(f"Agent '{agent.name}' has {count} traces")
```

## Filtering by Run

Get all spans for a specific agent run:

```python
# Run the agent and capture the run response
response = agent.run("Explain quantum computing")

# Get all traces for this specific run
traces, count = db.get_traces(run_id=response.run_id)

# Traces include the agent run, model calls, tool executions, etc.
for trace in traces:
    indent = "  " * (trace.parent_span_id is not None)
    print(f"{indent}{trace.name}: {trace.duration_ms}ms")
```

<Tip>
  Filtering by `run_id` gives you the complete execution tree for a single agent run, perfect for debugging specific issues.
</Tip>

## Filtering by Session

Get traces across multiple runs in the same session:

```python
from agno.session import Session

# Create a session
session = Session(session_id="user_conversation_123", db=db)

agent = Agent(
    name="Chat Agent",
    model=OpenAIChat(id="gpt-4o-mini"),
    session=session,
)

# Multiple runs in the same session
agent.run("Hello!")
agent.run("Tell me about AI")
agent.run("What are transformers?")

# Get all traces for this session
traces, count = db.get_traces(session_id=session.session_id)

print(f"Session has {count} traces across multiple runs")
```

## Filtering by User

Track traces for specific users:

```python
# Get traces for a specific user
traces, count = db.get_traces(user_id="user_12345", limit=50)

print(f"User 'user_12345' has {count} total traces")
```

## Time-Based Filtering

Query traces within a specific time range using `datetime` objects:

```python
from datetime import datetime, timedelta, timezone

# Get traces from the last hour
now = datetime.now(timezone.utc)
one_hour_ago = now - timedelta(hours=1)

traces, count = db.get_traces(
    start_time=one_hour_ago,
    end_time=now,
    limit=100
)

print(f"Found {count} traces in the last hour")

for trace in traces:
    print(f"  - {trace.name}: {trace.duration_ms}ms (status: {trace.status})")
```

<CodeGroup>

```python Last Hour
from datetime import datetime, timedelta, timezone

now = datetime.now(timezone.utc)
one_hour_ago = now - timedelta(hours=1)

traces, count = db.get_traces(
    start_time=one_hour_ago,
    end_time=now
)
```

```python Last 24 Hours
from datetime import datetime, timedelta, timezone

now = datetime.now(timezone.utc)
yesterday = now - timedelta(days=1)

traces, count = db.get_traces(
    start_time=yesterday,
    end_time=now
)
```

```python Custom Range
from datetime import datetime, timezone

# Query a specific date range
start_dt = datetime(2025, 11, 30, 0, 0, 0, tzinfo=timezone.utc) # year, month, day, hour, minute, second, microsecond, tzinfo
end_dt = datetime(2025, 12, 2, 0, 0, 0, tzinfo=timezone.utc)

traces, count = db.get_traces(
    start_time=start_dt,
    end_time=end_dt
)
```

</CodeGroup>

## Filtering by Trace ID

Get all spans in a specific trace execution tree:

```python
# Get a specific trace
traces, _ = db.get_traces(limit=1)
if traces:
    trace_id = traces[0].trace_id
    
    # Get all spans in this trace tree (use get_spans, not get_traces)
    all_spans = db.get_spans(trace_id=trace_id)
    
    print(f"Trace {trace_id} has {len(all_spans)} spans")
    
    # Build execution tree
    root_spans = [s for s in all_spans if s.parent_span_id is None]
    child_spans = [s for s in all_spans if s.parent_span_id is not None]
    
    for root in root_spans:
        print(f"Root: {root.name} ({root.duration_ms}ms)")
        for child in child_spans:
            if child.parent_span_id == root.span_id:
                print(f"  └─ {child.name} ({child.duration_ms}ms)")
```

## Combining Filters

You can combine multiple filters:

```python
from datetime import datetime, timedelta, timezone

now = datetime.now(timezone.utc)
one_day_ago = now - timedelta(days=1)

# Get traces for a specific agent in the last 24 hours
traces, count = db.get_traces(
    agent_id=agent.id,
    start_time=one_day_ago,
    end_time=now,
    limit=50
)

print(f"Agent has {count} traces in the last 24 hours")
```