---
title: Querying Spans
description: Query individual spans within traces to analyze specific operations
keywords: [tracing, spans, querying, debugging, analysis]
---

While traces represent complete executions, **spans** are the individual operations within those executions. Querying spans lets you analyze specific operations like model calls, tool executions, or nested agent runs.

## Span Object Structure

When you query spans, you receive `Span` objects with the following key fields:

| Field | Type | Description |
|-------|------|-------------|
| `span_id` | `str` | Unique identifier for this span |
| `trace_id` | `str` | Parent trace ID (groups related spans) |
| `parent_span_id` | `str` | Parent span ID (`None` for root spans) |
| `name` | `str` | Operation name (e.g., `OpenAIChat.invoke`, `get_top_stories`) |
| `status_code` | `str` | Status: `OK`, `ERROR`, or `UNSET` |
| `duration_ms` | `int` | Execution time in milliseconds |
| `start_time` | `datetime` | When the span started |
| `end_time` | `datetime` | When the span completed |
| `attributes` | `dict` | OpenTelemetry attributes (tokens, tool params, etc.) |

## Query Methods

There are two methods for retrieving spans:

| Method | Returns | Use Case |
|--------|---------|----------|
| `db.get_span()` | Single `Span` or `None` | Fetch one span by `span_id` |
| `db.get_spans()` | `List[Span]` | List spans for a trace or parent |

### `db.get_span()` - Single Span Lookup

```python
# Get a specific span by ID
span = db.get_span(span_id="abc123...")
if span:
    print(f"{span.name}: {span.duration_ms}ms")
```

### `db.get_spans()` - Multiple Spans

```python
# Get all spans for a trace
spans = db.get_spans(trace_id=trace.trace_id)

# Get child spans of a specific parent
children = db.get_spans(parent_span_id=root_span.span_id)
```

<Info>
  `db.get_spans()` returns a list of `Span` objects. Unlike `get_traces()`, it does not return a count.
</Info>

## Practical Example: Analyzing a Run

Here's how to drill down from a trace to its spans:

```python
from agno.db.sqlite import SqliteDb

db = SqliteDb(db_file="tmp/traces.db")

# Get the trace for a specific run
trace = db.get_trace(run_id=response.run_id)

if trace:
    print(f"Trace: {trace.name}")
    print(f"Duration: {trace.duration_ms}ms")
    print(f"Total Spans: {trace.total_spans}")
    
    # Get all spans for this trace, sorted by start time
    spans = db.get_spans(trace_id=trace.trace_id)
    spans_sorted = sorted(spans, key=lambda s: s.start_time)
    
    print(f"\nSpans ({len(spans_sorted)}):")
    for span in spans_sorted:
        indent = "  " if span.parent_span_id else ""
        duration = f"{span.duration_ms}ms" if span.duration_ms < 1000 else f"{span.duration_ms/1000:.1f}s"
        print(f"  {indent}- {span.name} ({duration}) [{span.status_code}]")
```

## Developer Resources
- View [Cookbook](https://github.com/agno-agi/agno/tree/main/cookbook/integrations/observability/trace_to_database.py) to see how to print full span tree for visualizing.