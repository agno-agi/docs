---
title: Session State
sidebarTitle: Overview
description: Share data between workflow steps and across runs
---

## What is Session State?

Session state is a shared dictionary that lets your workflow steps pass data to each other and persist information across multiple workflow runs. Think of it as a scratchpad that all your steps can read from and write to, and that survives between executions.

Unlike workflow history (which stores complete run results), session state is for real-time data sharing within and across runs.

## Why Use Session State?

Session state is useful when you need to:

- **Share data between steps** without passing it through step outputs
- **Maintain counters or accumulators** across workflow executions
- **Track workflow progress** or state across multiple runs
- **Store user preferences** that affect subsequent runs
- **Coordinate between steps** with shared flags or status information
- **Build up collections** of data over multiple runs

## How Session State Works

When you initialize session state on a workflow:

1. The workflow stores it in the database with the session
2. Each step gets a **copy** of the current state
3. Steps can read from and modify their copy
4. After the step completes, changes are **merged back** into the main state
5. The updated state is saved to the database
6. The next run loads the persisted state from the database

```python
from agno.workflow import Workflow
from agno.db.sqlite import SqliteDb

workflow = Workflow(
    name="Task Manager",
    db=SqliteDb(db_file="tasks.db"),
    steps=[...],
    session_state={"tasks": [], "counter": 0},  # Initial state
)

# First run - state starts with initial values
workflow.run(input="Add task 1")  # counter becomes 1

# Second run - state persists from first run
workflow.run(input="Add task 2")  # counter becomes 2
```

## Key Concepts

### Dictionary-Based

Session state must be a dictionary. You can nest dictionaries, use lists, numbers, strings, or any JSON-serializable data:

```python
session_state = {
    "counter": 0,
    "items": [],
    "config": {
        "enabled": True,
        "max_items": 10,
    },
}
```

### Automatic Merging

Changes made by steps are automatically merged back into the main state after execution.

### Persistence

With a database configured, session state persists across:
- Multiple runs in the same session
- Different workflow instances with the same session_id
- Application restarts

### Automatic Enrichment

Agno automatically adds these fields to session state during execution:

```python
{
    "current_user_id": "user-123",
    "current_session_id": "session-abc",
    "current_run_id": "run-xyz",
    "workflow_id": "workflow-123",
    "workflow_name": "My Workflow",
}
```

These fields are automatically removed before saving to the database.

## Session State vs Workflow History

Understanding when to use each:

| Feature | Session State | Workflow History |
|---------|--------------|------------------|
| **Purpose** | Share data between steps | Access previous run results |
| **Scope** | Single run + persisted | Previous completed runs only |
| **Mutability** | Read and write | Read only |
| **Size** | Keep small (frequently updated) | Can be large (historical data) |
| **Use for** | Counters, flags, progress tracking | Learning from past executions |
| **Access** | `session_state` parameter | `add_workflow_history_to_steps=True` |

<Note>
You can use both session state and workflow history together in the same workflow.
</Note>

## Quick Examples

### Initialize Session State

```python
workflow = Workflow(
    name="Shopping List Manager",
    db=SqliteDb(db_file="shopping.db"),
    steps=[...],
    session_state={
        "shopping_list": [],
        "budget": 100.0,
        "preferences": {
            "organic_only": False,
        },
    },
)
```

### Access in Custom Functions

```python
from agno.workflow.step import Step, StepInput, StepOutput

def add_item(step_input: StepInput, session_state: dict) -> StepOutput:
    item = step_input.input
    
    # Read and modify state
    items = session_state.get("items", [])
    items.append(item)
    session_state["items"] = items
    
    return StepOutput(content=f"Added {item}")

workflow = Workflow(
    name="List Manager",
    db=SqliteDb(db_file="lists.db"),
    steps=[Step(name="Add", executor=add_item)],
    session_state={"items": []},
)
```

### Access in Agent Tools

```python
from agno.agent import Agent

def add_to_cart(session_state: dict, item: str, price: float) -> str:
    cart = session_state.get("cart", [])
    cart.append({"item": item, "price": price})
    session_state["cart"] = cart
    return f"Added {item}"

shopping_agent = Agent(
    name="Shopping Assistant",
    tools=[add_to_cart],
)

workflow = Workflow(
    name="Shopping Workflow",
    db=SqliteDb(db_file="shop.db"),
    steps=[Step(name="Shop", agent=shopping_agent)],
    session_state={"cart": []},
)
```

## Usage Guides

Learn how to use session state in different scenarios:

<CardGroup cols={2}>
  <Card title="Custom Functions" icon="code" href="/basics/sessions/workflow-sessions/session-state/usage/custom-functions">
    Use state in custom function steps
  </Card>
  <Card title="Agent Tools" icon="wrench" href="/basics/sessions/workflow-sessions/session-state/usage/agent-tools">
    Access state from agent and team tools
  </Card>
  <Card title="Conditions & Routers" icon="code-branch" href="/basics/sessions/workflow-sessions/session-state/usage/conditions-routers">
    Use state in conditions and routers
  </Card>
  <Card title="Programmatic Access" icon="terminal" href="/basics/sessions/workflow-sessions/session-state/usage/programmatic-access">
    Read and update state directly
  </Card>
</CardGroup>

## Common Patterns

### Counter Pattern

```python
def process_request(step_input: StepInput, session_state: dict) -> StepOutput:
    count = session_state.get("request_count", 0) + 1
    session_state["request_count"] = count
    return StepOutput(content=f"Request #{count}")
```

### List Accumulator Pattern

```python
def collect_feedback(step_input: StepInput, session_state: dict) -> StepOutput:
    feedback = step_input.input
    all_feedback = session_state.get("feedback_list", [])
    all_feedback.append(feedback)
    session_state["feedback_list"] = all_feedback
    return StepOutput(content=f"Collected {len(all_feedback)} items")
```

### State Machine Pattern

```python
def advance_stage(step_input: StepInput, session_state: dict) -> StepOutput:
    stages = ["init", "processing", "review", "complete"]
    current = session_state.get("stage", "init")
    current_index = stages.index(current)
    next_stage = stages[min(current_index + 1, len(stages) - 1)]
    session_state["stage"] = next_stage
    return StepOutput(content=f"Advanced to: {next_stage}")
```

## Best Practices

### Keep State Small and Focused

```python
# Good: Focused state
session_state = {
    "task_count": 0,
    "last_task_type": None,
}

# Avoid: Storing large data
session_state = {
    "all_historical_data": [...],  # Use workflow history instead
}
```

### Initialize All Keys

```python
# Good: All keys initialized
session_state = {
    "counter": 0,
    "enabled": False,
    "items": [],
    "metadata": {},
}
```

### Use Descriptive Names

```python
# Good: Clear purpose
session_state = {
    "budget_check_count": 0,
    "user_verified": False,
    "pending_approvals": [],
}
```

## Related Topics

<CardGroup cols={2}>
  <Card title="Workflow History" icon="clock-rotate-left" href="/basics/sessions/workflow-sessions/workflow-history/overview">
    Access previous run results
  </Card>
  <Card title="Workflow Session Naming" icon="tag" href="/basics/sessions/workflow-sessions/workflow-naming/overview">
    Organize and identify sessions
  </Card>
  <Card title="Overview" icon="book" href="/basics/sessions/workflow-sessions/overview">
    Back to workflow sessions basics
  </Card>
  <Card title="Metrics" icon="chart-line" href="/basics/sessions/workflow-sessions/metrics/overview">
    Track workflow performance
  </Card>
</CardGroup>

## Developer Resources

- View [session state examples](https://github.com/agno-agi/agno/tree/main/cookbook/workflows/_06_advanced_concepts/_04_shared_session_state)
- See the [Workflow API](/reference/workflows/workflow)

