---
title: Programmatic Access
sidebarTitle: Programmatic Access
description: Read and update session state directly
---

## Get Current State

```python
from agno.workflow import Workflow
from agno.db.sqlite import SqliteDb

workflow = Workflow(
    name="Task Manager",
    db=SqliteDb(db_file="tasks.db"),
    steps=[...],
    session_state={"counter": 0, "items": []},
)

# Run workflow
workflow.run(input="Task 1")

# Get the current session state
state = workflow.get_session_state(session_id=workflow.session_id)

print(f"Counter: {state['counter']}")
print(f"Items: {state['items']}")
```

## Update State Directly

```python
# Update specific keys in session state
workflow.update_session_state(
    session_state_updates={
        "user_preference": "dark_mode",
        "notification_enabled": True,
    },
    session_id=workflow.session_id,
)
```

## Async Methods

```python
# Async versions
state = await workflow.aget_session_state(session_id=workflow.session_id)

await workflow.aupdate_session_state(
    session_state_updates={"key": "value"},
    session_id=workflow.session_id,
)
```

## Check State Before Running

```python
def should_run_workflow(workflow, session_id):
    state = workflow.get_session_state(session_id=session_id)
    
    # Check if ready
    if not state.get("initialized"):
        return False, "Not initialized"
    
    # Check if quota exceeded
    if state.get("run_count", 0) >= 10:
        return False, "Quota exceeded"
    
    return True, "Ready"

# Usage
can_run, reason = should_run_workflow(workflow, "user-123")
if can_run:
    workflow.run(input="Task", session_id="user-123")
else:
    print(f"Cannot run: {reason}")
```

## Batch Updates

```python
# Update multiple fields at once
updates = {
    "counter": 10,
    "last_run": "2024-01-01",
    "config": {"enabled": True},
}

workflow.update_session_state(
    session_state_updates=updates,
    session_id=workflow.session_id,
)
```

## Read State for Analysis

```python
def analyze_session_state(workflow, session_id):
    state = workflow.get_session_state(session_id=session_id)
    
    return {
        "total_items": len(state.get("items", [])),
        "counter_value": state.get("counter", 0),
        "is_active": state.get("active", False),
    }

# Usage
analysis = analyze_session_state(workflow, "user-123")
print(f"Analysis: {analysis}")
```

## Reset State

```python
def reset_session_state(workflow, session_id):
    """Reset state to initial values"""
    workflow.update_session_state(
        session_state_updates={
            "counter": 0,
            "items": [],
            "initialized": True,
        },
        session_id=session_id,
    )

reset_session_state(workflow, "user-123")
```

## Troubleshooting

### State Not Persisting

If updates aren't saving:

```python
# Check database is configured
if workflow.db is None:
    print("No database configured")

# Check session exists
session = workflow.get_session(session_id=workflow.session_id)
if session is None:
    print("Session doesn't exist")
```

### State is None

```python
try:
    state = workflow.get_session_state(session_id="unknown")
except Exception as e:
    print(f"Error: {e}")
```

## Related Topics

<CardGroup cols={2}>
  <Card title="Custom Functions" icon="code" href="/basics/sessions/workflow-sessions/session-state/usage/custom-functions">
    Use state in custom functions
  </Card>
  <Card title="Agent Tools" icon="wrench" href="/basics/sessions/workflow-sessions/session-state/usage/agent-tools">
    Access state from agent tools
  </Card>
</CardGroup>

