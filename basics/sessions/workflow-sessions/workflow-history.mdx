---
title: Workflow History
sidebarTitle: Workflow History
description: Learn how workflows access previous execution results to improve performance
---

## What is Workflow History?

Workflow history lets your workflow steps access the results from previous workflow runs. This is different from conversation history in agents or teams. Instead of storing individual messages, workflow history stores complete execution records with inputs and outputs.

When you enable workflow history, your workflow steps can see what happened in earlier runs and use that context to make better decisions, avoid repetition, or build on previous work.

## Why Use Workflow History?

Workflow history is useful when you want workflows to:

- **Learn from previous runs** to avoid repeating the same work
- **Build on prior results** to create more sophisticated outputs
- **Maintain context** across multiple executions
- **Avoid duplication** when generating content or processing data
- **Reference past decisions** to ensure consistency

## How Workflow History Works

When workflow history is enabled, Agno formats the previous run results and prepends them to each step's input. This gives your agents, teams, or custom functions access to what happened before, without you having to manually pass it around.

### History Format

The history is formatted as structured text that looks like this:

```
<workflow_history_context>
[Workflow Run-1]
User input: Create a blog post about AI trends
Workflow output: Blog post about transformers and LLMs...

[Workflow Run-2]
User input: Write about machine learning automation
Workflow output: Article about AutoML and no-code AI...

</workflow_history_context>
```

This formatted history is prepended to the step's input message before execution.

## Enabling Workflow History

### Enable for All Steps

Set `add_workflow_history_to_steps=True` on the workflow to enable history for all steps:

```python
from agno.workflow import Workflow
from agno.workflow.step import Step
from agno.db.sqlite import SqliteDb

workflow = Workflow(
    name="Content Creator",
    db=SqliteDb(db_file="workflows.db"),
    steps=[
        Step(name="Research", agent=researcher),
        Step(name="Write", agent=writer),
        Step(name="Review", agent=reviewer),
    ],
    add_workflow_history_to_steps=True,  # Enable for ALL steps
    num_history_runs=3,  # Include last 3 runs (default: 3)
)

# First run
workflow.run(input="Write about AI trends")

# Second run (all steps see the previous run)
workflow.run(input="Write about ML automation")
```

All three steps (Research, Write, Review) will now see the history from previous workflow runs.

### Enable for Specific Steps

You can control history on a per-step basis using `add_workflow_history` on individual steps:

```python
workflow = Workflow(
    name="Content Pipeline",
    db=SqliteDb(db_file="workflows.db"),
    steps=[
        # Research step doesn't need history
        Step(
            name="Research", 
            agent=researcher,
            add_workflow_history=False,
        ),
        # Writer sees previous content to avoid repetition
        Step(
            name="Write", 
            agent=writer,
            add_workflow_history=True,  # Enable for this step only
        ),
        # Publisher doesn't need history
        Step(
            name="Publish", 
            agent=publisher,
        ),
    ],
    add_workflow_history_to_steps=False,  # Disabled by default
)
```

<Note>
When `add_workflow_history` is set on a step, it overrides the workflow-level setting. If it's `None` (not set), the step uses the workflow's default.
</Note>

### Control History Size

Use `num_history_runs` to control how many previous runs are included:

```python
# Workflow-level setting (applies to all steps that use history)
workflow = Workflow(
    name="Research Pipeline",
    db=SqliteDb(db_file="workflows.db"),
    steps=[...],
    add_workflow_history_to_steps=True,
    num_history_runs=5,  # Include last 5 runs
)

# Step-level override
Step(
    name="Deep Analysis",
    agent=analyst,
    add_workflow_history=True,
    num_history_runs=10,  # This step sees 10 runs
)
```

## What Gets Included in History

Workflow history includes only **completed runs**. Pending, failed, or cancelled runs are not included.

For each completed run, the history contains:

- **Input:** The data passed to `workflow.run(input=...)`
- **Output:** The final result from the workflow

Individual step results within a run are not included in the formatted history. Only the overall workflow input and output are shown.

## Example Use Cases

### Avoiding Content Repetition

Perfect for content generation workflows that need to avoid repeating topics:

```python
content_creator = Agent(
    name="Content Creator",
    instructions=[
        "Create engaging content based on the topic.",
        "Review workflow history to see what topics you've covered.",
        "Avoid repeating similar content or themes.",
        "Build on previous work to create fresh perspectives.",
    ],
)

workflow = Workflow(
    name="Blog Generator",
    db=SqliteDb(db_file="blog.db"),
    steps=[
        Step(name="Generate", agent=content_creator),
    ],
    add_workflow_history_to_steps=True,
    num_history_runs=10,  # Check last 10 posts
)

# Each new post can see what was written before
workflow.run(input="Write about Python best practices")
workflow.run(input="Write about code optimization")  # Won't repeat Python content
```

### Building on Previous Analysis

Great for research workflows that need to maintain context:

```python
research_workflow = Workflow(
    name="Competitive Analysis",
    db=SqliteDb(db_file="research.db"),
    steps=[
        Step(
            name="Analyze Competitor",
            agent=analyst,
            add_workflow_history=True,
        ),
        Step(
            name="Generate Insights",
            agent=strategist,
            add_workflow_history=True,
        ),
    ],
    num_history_runs=5,
)

# Analyze competitors one by one
workflow.run(input="Analyze competitor A")
workflow.run(input="Analyze competitor B")  # Can reference competitor A
workflow.run(input="Compare A and B")       # Has context from both
```

### Learning from User Feedback

Workflows that improve based on previous interactions:

```python
assistant_workflow = Workflow(
    name="Personal Assistant",
    db=SqliteDb(db_file="assistant.db"),
    steps=[
        Step(
            name="Process Request",
            agent=assistant,
            add_workflow_history=True,
        ),
    ],
    num_history_runs=20,  # Remember last 20 interactions
)

# Assistant learns user preferences over time
workflow.run(input="Schedule a meeting")
workflow.run(input="Another meeting")  # Remembers scheduling preferences
```

### Continuous Conversations

Enable natural conversation flow across multiple runs:

```python
tutor = Agent(
    name="AI Tutor",
    instructions=[
        "You are a personalized tutor.",
        "Review our conversation history from previous sessions.",
        "Build on what the student has learned.",
        "Don't repeat questions or explanations.",
    ],
)

tutoring_workflow = Workflow(
    name="AI Tutor",
    db=SqliteDb(db_file="tutoring.db"),
    steps=[Step(name="Teach", agent=tutor)],
    add_workflow_history_to_steps=True,
    num_history_runs=10,
)

# Natural multi-session conversation
tutoring_workflow.run(input="I'm struggling with calculus")
# ... next day ...
tutoring_workflow.run(input="Can we continue with derivatives?")
```

## Workflow History vs Agent History

It's important to understand the difference between workflow history and agent/team history:

| Feature | Workflow History | Agent/Team History |
|---------|-----------------|-------------------|
| **What's stored** | Complete workflow runs (input → output) | Individual messages in conversation |
| **How it's added** | Prepended to step input as formatted text | Added to LLM context as message history |
| **Granularity** | Workflow-level (entire execution) | Message-level (each exchange) |
| **Enable with** | `add_workflow_history_to_steps=True` | `add_history_to_context=True` |
| **Control size** | `num_history_runs` (number of runs) | `num_history_runs` or `num_history_messages` |

### Using Both Together

When you use agents or teams inside workflow steps, you can enable both types of history:

```python
# Agent has its own conversation history
researcher = Agent(
    name="Researcher",
    add_history_to_context=True,  # Agent's own message history
    num_history_runs=3,
)

# Workflow has run-based history
workflow = Workflow(
    name="Research Pipeline",
    db=SqliteDb(db_file="research.db"),
    steps=[
        Step(name="Research", agent=researcher),
    ],
    add_workflow_history_to_steps=True,  # Workflow's run history
    num_history_runs=5,
)

# The researcher sees:
# 1. Workflow history (previous workflow runs)
# 2. Agent history (previous messages within the agent's own session)
```

<Warning>
When using both workflow and agent history, be mindful of context window limits. Large amounts of history from both sources can consume your token budget quickly.
</Warning>

## Accessing History Programmatically

You can also access workflow history directly from the session:

```python
# Get the session
session = workflow.get_session(session_id=workflow.session_id)

# Get raw history data (list of tuples: input, output)
history = session.get_workflow_history(num_runs=5)
for input_text, output_text in history:
    print(f"Input: {input_text}")
    print(f"Output: {output_text}")
    print("---")

# Get formatted history context (same format steps receive)
formatted_history = session.get_workflow_history_context(num_runs=5)
print(formatted_history)
```

## Best Practices

### Choose the Right Number of Runs

```python
# Short-term context (3-5 runs)
workflow = Workflow(
    name="Quick Tasks",
    add_workflow_history_to_steps=True,
    num_history_runs=3,  # Just recent context
)

# Long-term memory (10-20 runs)
workflow = Workflow(
    name="Learning Assistant",
    add_workflow_history_to_steps=True,
    num_history_runs=15,  # Remember more interactions
)
```

### Be Selective About Which Steps Need History

Not every step benefits from history. Enable it only where needed:

```python
workflow = Workflow(
    name="Content Pipeline",
    steps=[
        # Data collection doesn't need history
        Step(name="Fetch Data", agent=fetcher),
        
        # Analysis benefits from seeing previous patterns
        Step(
            name="Analyze",
            agent=analyst,
            add_workflow_history=True,
        ),
        
        # Formatting doesn't need history
        Step(name="Format", agent=formatter),
    ],
)
```

### Provide Context in Agent Instructions

Help your agents understand and use the history:

```python
writer = Agent(
    name="Content Writer",
    instructions=[
        "You are a content writer.",
        "IMPORTANT: Check the workflow history above.",
        "Avoid repeating topics or themes from previous runs.",
        "Build on previous content to create a cohesive series.",
    ],
)
```

### Monitor Context Size

Keep an eye on how much history you're including:

```python
# Check what's being sent to steps
session = workflow.get_session(session_id=workflow.session_id)
history_context = session.get_workflow_history_context(num_runs=10)
print(f"History length: {len(history_context)} characters")
```

## Troubleshooting

### History Not Appearing

If your steps aren't seeing history:

1. **Check database is set:** Workflow must have a `db` parameter
2. **Verify history is enabled:** Check `add_workflow_history_to_steps=True` or step-level setting
3. **Ensure you have completed runs:** History only includes completed runs
4. **Check session ID:** Make sure runs are using the same session

```python
# Correct setup
workflow = Workflow(
    name="My Workflow",
    db=SqliteDb(db_file="workflow.db"),  # ✅ Database set
    add_workflow_history_to_steps=True,   # ✅ History enabled
    steps=[...],
)
```

### Too Much Context

If you're hitting context limits:

- **Reduce `num_history_runs`:** Use fewer previous runs
- **Disable for some steps:** Not all steps need history
- **Use selective history:** Only enable where it adds value

### History Has Wrong Content

If the history shows unexpected runs:

- **Check session ID:** Different session IDs have separate histories
- **Verify run status:** Only completed runs appear in history
- **Check timing:** History is based on when runs complete, not when they start

## Next Steps

- **[Session State](/basics/sessions/workflow-sessions/session-state)** - Share data between steps in real time
- **[Workflow Agents](/basics/sessions/workflow-sessions/workflow-agents)** - Use agents that decide when to run workflows
- **[Metrics](/basics/sessions/workflow-sessions/metrics)** - Track workflow performance

## Developer Resources

- View [workflow history examples](https://github.com/agno-agi/agno/tree/main/cookbook/workflows/_06_advanced_concepts/_07_workflow_history)
- See the [WorkflowSession API](/reference/workflows/session)

