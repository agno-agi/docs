---
title: Access History Programmatically
sidebarTitle: Programmatic Access
description: Read and work with workflow history data directly from sessions
---

## Get Raw History Data

Access workflow history as structured data using `get_workflow_history()`:

```python
from agno.workflow import Workflow
from agno.db.sqlite import SqliteDb

workflow = Workflow(
    name="Research Pipeline",
    db=SqliteDb(db_file="workflows.db"),
    steps=[...],
)

# Run a few times
workflow.run(input="Research AI")
workflow.run(input="Research ML")
workflow.run(input="Research DL")

# Get the session
session = workflow.get_session(session_id=workflow.session_id)

# Get raw history data (list of tuples: input, output)
history = session.get_workflow_history(num_runs=5)

for i, (input_text, output_text) in enumerate(history, 1):
    print(f"Run {i}:")
    print(f"  Input: {input_text}")
    print(f"  Output: {output_text}")
    print("---")
```

## Get Formatted History Context

Access the same formatted history that steps receive:

```python
# Get formatted history context (same format steps receive)
formatted_history = session.get_workflow_history_context(num_runs=5)

print(formatted_history)
# Output:
# <workflow_history_context>
# [Workflow Run-1]
# User input: Research AI
# Workflow output: AI research results...
# 
# [Workflow Run-2]
# User input: Research ML
# Workflow output: ML research results...
# </workflow_history_context>
```

## Limit History Results

Control how many runs are returned:

```python
# Get last 3 runs only
recent_history = session.get_workflow_history(num_runs=3)
print(f"Recent history: {len(recent_history)} runs")

# Get all available history
all_history = session.get_workflow_history(num_runs=None)
print(f"All history: {len(all_history)} runs")
```

## Analyze History Data

Process history data for insights:

```python
def analyze_workflow_history(workflow, session_id=None):
    """Analyze workflow history and return insights"""
    session = workflow.get_session(session_id=session_id or workflow.session_id)
    history = session.get_workflow_history(num_runs=None)
    
    if not history:
        return {"message": "No history available"}
    
    # Calculate statistics
    total_runs = len(history)
    avg_input_length = sum(len(inp) for inp, _ in history) / total_runs
    avg_output_length = sum(len(out) for _, out in history) / total_runs
    
    return {
        "total_runs": total_runs,
        "avg_input_length": avg_input_length,
        "avg_output_length": avg_output_length,
        "first_run_input": history[0][0] if history else None,
        "latest_run_input": history[-1][0] if history else None,
    }

# Usage
insights = analyze_workflow_history(workflow)
print(f"Total runs: {insights['total_runs']}")
print(f"Avg input length: {insights['avg_input_length']:.0f} chars")
print(f"Avg output length: {insights['avg_output_length']:.0f} chars")
```

## Search History

Find specific runs in history:

```python
def search_workflow_history(workflow, search_term, session_id=None):
    """Search workflow history for specific content"""
    session = workflow.get_session(session_id=session_id or workflow.session_id)
    history = session.get_workflow_history(num_runs=None)
    
    matching_runs = []
    
    for i, (input_text, output_text) in enumerate(history, 1):
        if search_term.lower() in input_text.lower() or \
           search_term.lower() in output_text.lower():
            matching_runs.append({
                "run_number": i,
                "input": input_text,
                "output": output_text,
            })
    
    return matching_runs

# Usage
results = search_workflow_history(workflow, "AI trends")
print(f"Found {len(results)} matching runs")

for run in results:
    print(f"\nRun #{run['run_number']}:")
    print(f"Input: {run['input'][:100]}...")
```

## Export History

Export history data for analysis or backup:

```python
import json
from datetime import datetime

def export_workflow_history(workflow, output_file, session_id=None):
    """Export workflow history to JSON file"""
    session = workflow.get_session(session_id=session_id or workflow.session_id)
    history = session.get_workflow_history(num_runs=None)
    
    export_data = {
        "exported_at": datetime.now().isoformat(),
        "session_id": session.session_id,
        "workflow_name": session.workflow_name,
        "total_runs": len(history),
        "runs": [
            {
                "run_number": i,
                "input": input_text,
                "output": output_text,
            }
            for i, (input_text, output_text) in enumerate(history, 1)
        ],
    }
    
    with open(output_file, 'w') as f:
        json.dump(export_data, f, indent=2)
    
    print(f"Exported {len(history)} runs to {output_file}")

# Usage
export_workflow_history(workflow, "workflow_history_export.json")
```

## Compare History Across Sessions

Compare history from different sessions:

```python
def compare_sessions(workflow, session_id_1, session_id_2):
    """Compare history between two sessions"""
    session1 = workflow.get_session(session_id=session_id_1)
    session2 = workflow.get_session(session_id=session_id_2)
    
    history1 = session1.get_workflow_history(num_runs=None)
    history2 = session2.get_workflow_history(num_runs=None)
    
    return {
        "session_1": {
            "id": session_id_1,
            "runs": len(history1),
            "topics": [inp[:50] for inp, _ in history1],
        },
        "session_2": {
            "id": session_id_2,
            "runs": len(history2),
            "topics": [inp[:50] for inp, _ in history2],
        },
    }

# Usage
comparison = compare_sessions(workflow, "user-123", "user-456")
print(f"User 123: {comparison['session_1']['runs']} runs")
print(f"User 456: {comparison['session_2']['runs']} runs")
```

## Check History Availability

Verify history exists before using it:

```python
def has_sufficient_history(workflow, min_runs=3, session_id=None):
    """Check if workflow has sufficient history"""
    try:
        session = workflow.get_session(session_id=session_id or workflow.session_id)
        
        if not session:
            return False
        
        history = session.get_workflow_history(num_runs=None)
        return len(history) >= min_runs
        
    except Exception as e:
        print(f"Error checking history: {e}")
        return False

# Usage
if has_sufficient_history(workflow, min_runs=5):
    print("Sufficient history available")
    # Proceed with history-dependent operations
else:
    print("Not enough history yet")
    # Run workflow more times or handle accordingly
```

## Custom History Processing

Create custom history representations:

```python
def create_history_summary(workflow, session_id=None):
    """Create a summary of workflow history"""
    session = workflow.get_session(session_id=session_id or workflow.session_id)
    history = session.get_workflow_history(num_runs=10)
    
    if not history:
        return "No history available"
    
    summary_parts = [
        f"Workflow History Summary ({len(history)} runs):",
        ""
    ]
    
    for i, (input_text, output_text) in enumerate(history, 1):
        # Truncate for summary
        input_preview = input_text[:60] + "..." if len(input_text) > 60 else input_text
        output_preview = output_text[:60] + "..." if len(output_text) > 60 else output_text
        
        summary_parts.append(f"Run {i}:")
        summary_parts.append(f"  → {input_preview}")
        summary_parts.append(f"  ← {output_preview}")
        summary_parts.append("")
    
    return "\n".join(summary_parts)

# Usage
summary = create_history_summary(workflow)
print(summary)
```

## Async Access

All history methods have async versions:

```python
async def async_history_example(workflow):
    """Example using async history access"""
    # Get session asynchronously
    session = await workflow.aget_session(session_id=workflow.session_id)
    
    # Get history (method itself is not async, but session retrieval is)
    history = session.get_workflow_history(num_runs=5)
    
    print(f"Found {len(history)} runs asynchronously")
    
    return history

# Usage with asyncio
import asyncio
history = asyncio.run(async_history_example(workflow))
```

## Integration with Custom Logic

Use history data to make decisions:

```python
def should_continue_workflow(workflow, session_id=None):
    """Decide if workflow should continue based on history"""
    session = workflow.get_session(session_id=session_id or workflow.session_id)
    history = session.get_workflow_history(num_runs=5)
    
    if not history:
        return True, "No history, starting fresh"
    
    if len(history) >= 10:
        return False, "Reached maximum runs"
    
    # Check if recent runs are similar (avoid loops)
    if len(history) >= 3:
        recent_inputs = [inp for inp, _ in history[-3:]]
        if len(set(recent_inputs)) == 1:
            return False, "Detected repetitive inputs"
    
    return True, "Can continue"

# Usage
should_run, reason = should_continue_workflow(workflow)

if should_run:
    workflow.run(input="Next task")
else:
    print(f"Not running: {reason}")
```

## Troubleshooting

### History Returns Empty

If history is empty:

```python
session = workflow.get_session(session_id=workflow.session_id)

if not session:
    print("Session doesn't exist")
elif not session.runs:
    print("No runs recorded")
else:
    completed_runs = [r for r in session.runs if r.status == "completed"]
    print(f"Completed runs: {len(completed_runs)}")
    print(f"Total runs: {len(session.runs)}")
```

### Session Not Found

Handle missing sessions:

```python
try:
    session = workflow.get_session(session_id="unknown-session")
    if session:
        history = session.get_workflow_history()
    else:
        print("Session not found")
except Exception as e:
    print(f"Error: {e}")
```

## Related Topics

<CardGroup cols={2}>
  <Card title="Enable History" icon="toggle-on" href="/basics/sessions/workflow-sessions/workflow-history/usage/enable-history">
    Enable history globally or per-step
  </Card>
  <Card title="Control History Size" icon="list-ol" href="/basics/sessions/workflow-sessions/workflow-history/usage/control-size">
    Limit the number of runs included
  </Card>
</CardGroup>

