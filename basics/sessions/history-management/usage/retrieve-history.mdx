---
title: Retrieve Chat History
description: Programmatically access conversation history from your sessions
---

This example demonstrates how to retrieve and work with chat history programmatically using the `get_chat_history()` method.

<Tabs>
<Tab title="Agent">

## Code

```python retrieve_history.py
from agno.agent import Agent
from agno.db.postgres import PostgresDb
from agno.models.openai import OpenAIChat

db_url = "postgresql+psycopg://ai:ai@localhost:5532/ai"

db = PostgresDb(db_url=db_url, session_table="sessions")

agent = Agent(
    model=OpenAIChat(id="gpt-4o-mini"),
    db=db,
    session_id="chat_history",
    instructions="You are a helpful assistant that can answer questions about space and oceans.",
    add_history_to_context=True,
)

# First interaction
agent.print_response("Tell me a new interesting fact about space")

# Retrieve chat history
chat_history = agent.get_chat_history()
print(f"\nðŸ“œ Chat History ({len(chat_history)} messages):")
for msg in chat_history:
    print(f"  - {msg.role}: {msg.content[:50]}...")

# Second interaction
agent.print_response("Tell me a new interesting fact about oceans")

# Retrieve updated history
chat_history = agent.get_chat_history()
print(f"\nðŸ“œ Updated Chat History ({len(chat_history)} messages):")
for msg in chat_history:
    print(f"  - {msg.role}: {msg.content[:50]}...")
```

## Usage

<Steps>
  <Snippet file="create-venv-step.mdx" />

  <Step title="Install libraries">
    ```bash
    pip install -U agno openai psycopg
    ```
  </Step>

  <Step title="Setup PostgreSQL">
    ```bash
    # Make sure PostgreSQL is running
    # Update connection string in the code as needed
    ```
  </Step>

  <Step title="Export your OpenAI API key">
    <CodeGroup>
    ```bash Mac/Linux
      export OPENAI_API_KEY="your_openai_api_key_here"
    ```

    ```bash Windows
      $Env:OPENAI_API_KEY="your_openai_api_key_here"
    ```
    </CodeGroup> 
  </Step>

  <Step title="Run the code">
    ```bash
    python retrieve_history.py
    ```
  </Step>
</Steps>

</Tab>

<Tab title="Team">

## Code

```python retrieve_history.py
from agno.agent import Agent
from agno.team import Team
from agno.db.postgres import PostgresDb
from agno.models.openai import OpenAIChat

db_url = "postgresql+psycopg://ai:ai@localhost:5532/ai"

db = PostgresDb(db_url=db_url, session_table="sessions")

agent = Agent(model=OpenAIChat(id="gpt-4o-mini"))

team = Team(
    model=OpenAIChat(id="gpt-4o-mini"),
    members=[agent],
    db=db,
)

# First interaction
team.print_response("Tell me a new interesting fact about space")

# Retrieve chat history
chat_history = team.get_chat_history()
print(f"\nðŸ“œ Chat History ({len(chat_history)} messages):")
for msg in chat_history:
    print(f"  - {msg.role}: {msg.content[:50]}...")

# Second interaction
team.print_response("Tell me a new interesting fact about oceans")

# Retrieve updated history
chat_history = team.get_chat_history()
print(f"\nðŸ“œ Updated Chat History ({len(chat_history)} messages):")
for msg in chat_history:
    print(f"  - {msg.role}: {msg.content[:50]}...")
```

## Usage

<Steps>
  <Snippet file="create-venv-step.mdx" />

  <Step title="Install libraries">
    ```bash
    pip install -U agno openai psycopg
    ```
  </Step>

  <Step title="Setup PostgreSQL">
    ```bash
    # Make sure PostgreSQL is running
    # Update connection string in the code as needed
    ```
  </Step>

  <Step title="Export your OpenAI API key">
    <CodeGroup>
    ```bash Mac/Linux
      export OPENAI_API_KEY="your_openai_api_key_here"
    ```

    ```bash Windows
      $Env:OPENAI_API_KEY="your_openai_api_key_here"
    ```
    </CodeGroup> 
  </Step>

  <Step title="Run the code">
    ```bash
    python retrieve_history.py
    ```
  </Step>
</Steps>

</Tab>
</Tabs>

## Available Methods

### Get Chat History
Returns all unique messages across the session (deduplicated):

```python
chat_history = agent.get_chat_history()
```

### Get Messages for Session
Returns all messages including duplicates from multiple runs:

```python
messages = agent.get_messages_for_session()
```

### Get Last Run
Retrieve the most recent run output:

```python
last_run = agent.get_last_run_output()
if last_run:
    print(f"Tokens used: {last_run.metrics.total_tokens}")
```

## Giving Agents Access to History

Instead of manually retrieving history, you can give agents a tool to access their own history:

```python
agent = Agent(
    model=OpenAIChat(id="gpt-4o-mini"),
    db=db,
    read_chat_history=True,  # Adds get_chat_history() tool
)
```

Now the agent can call `get_chat_history()` when it needs to reference something from earlier in the conversation.

## Working with Message Objects

Each message in the history has useful properties:

```python
for msg in chat_history:
    print(f"Role: {msg.role}")
    print(f"Content: {msg.content}")
    print(f"Created: {msg.created_at}")
    
    if msg.role == "assistant":
        # Check metrics for assistant messages
        if msg.metrics:
            print(f"Tokens: {msg.metrics.total_tokens}")
    
    if msg.role == "tool":
        # Tool results
        print(f"Tool: {msg.tool_name}")
```

## Key Points

- **Requires Database**: History retrieval only works with configured database storage
- **Deduplicated**: `get_chat_history()` returns unique messages (no duplicates from history context)
- **Session Scoped**: History is tied to the specific `session_id`
- **Real-time**: Always reflects the current state of the session

## Next Steps

- Learn about [session summaries](/basics/sessions/session-summaries/overview) for condensing long histories
- Explore [storage control](/basics/sessions/storage-control/overview) to optimize what gets saved

